# Agricultural Drone Flight Planner

## Описание

Этот проект представляет собой систему планирования полета сельскохозяйственного дрона. Он позволяет рассчитать оптимальные маршруты полета, учитывая запретные зоны, выбрать подходящий дрон и рассчитать необходимые ресурсы для обработки поля. Результаты могут быть экспортированы в формате GeoJSON для дальнейшего использования.

## Основные функции

1. Расчет метрик полета: Рассчитывает количество сессий, время полета, количество посадок, необходимый раствор и батареи, а также затраты времени на обработку поля.
2. Генерация сетки полета: Создает сетку полета, учитывая размеры поля и характеристики дрона.
3. Удаление запретных зон: Удаляет из сетки полетные зоны, пересекающиеся с запретными зонами.
4. Расчет маршрута полета: Рассчитывает оптимальный маршрут полета дрона.
5. Экспорт маршрутов в GeoJSON: Экспортирует маршруты полета в файл GeoJSON.
6. Обработка команд оператора: Обрабатывает команды оператора, такие как возврат на базу, экстренная посадка и удержание позиции.

## Структура проекта

- main.py: Основной скрипт, который запускает процесс планирования полета.
- drones.py: Определяет класс Drone и содержит словарь с доступными моделями дронов.
- fields.py: Обрабатывает данные поля, загружает координаты поля, запретных зон и начальной точки, а также рассчитывает площадь поля.
- geojson_export.py: Экспортирует маршруты полета в файл GeoJSON.
- operator_commands.py: Обрабатывает команды оператора и выполняет маршруты полета.
- routing.py: Содержит функции для генерации сетки полета, удаления запретных зон и расчета маршрута полета.

## Установка и запуск

### Требования

- Python 3.7+
- Библиотеки: numpy, geojson, shapely, pyproj

### Установка

1. Клонируйте репозиторий:
   
   git clone https://github.com/yourusername/agricultural-drone-flight-planner.git
   cd agricultural-drone-flight-planner
   

2. Установите необходимые зависимости:
   
   pip install numpy geojson shapely pyproj
   

### Запуск

1. Поместите файлы GeoJSON с данными поля, запретных зон и начальной точки в корневую директорию проекта.
2. Запустите основной скрипт:
   
   python main.py
   

## Пример использования

1. Загрузка данных поля:
   - Загружаются координаты поля, запретных зон и начальной точки из файлов GeoJSON.
   - Координаты поля преобразуются в метры с использованием UTM.

   field_processor = FieldProcessor('field.geojson', 'restrict_area.geojson', 'point_start.geojson')
   processed_data = field_processor.process_field()
   

2. Выбор дрона:
   - Выбирается дрон из доступных моделей.
   - Проверяются свойства выбранного дрона.
   
   drone_name = "New Agricultural Drone"
   drone = drones[drone_name].get_properties()
   

3. Расчет метрик полета:
   - Рассчитываются количество сессий, время полета, количество посадок, необходимый раствор и батареи, а также затраты времени на обработку поля.
   
   flight_metrics = calculate_flight_metrics(drone, processed_data['field_area'])
   

5. Генерация сетки полета и расчет маршрута:
   - Создается сетка полета, учитывая размеры поля и характеристики дрона.
   - Удаляются зоны, пересекающиеся с запретными зонами.
   - 
   grid = generate_flight_grid(Polygon(processed_data['field_coords']), drone['spray_width'], drone['flight_radius'])
   valid_grid = remove_restricted_areas(grid, processed_data['restricted_zones'])
   flight_paths = calculate_flight_path(valid_grid, processed_data['start_point'])
   

6. Расчет маршрута полета:
   - Рассчитывается оптимальный маршрут полета дрона.

7. Экспорт маршрутов в GeoJSON:
   - Маршруты полета экспортируются в файл GeoJSON.
   
   export_flight_paths_to_geojson(flight_paths, "flight_paths.geojson")

8. Обработка команд оператора:
   - Обрабатываются команды оператора, такие как возврат на базу, экстренная посадка и удержание позиции.
   
## Детальное описание по каждому листу

### main.py

Основной скрипт, который запускает процесс планирования полета. Выполняет следующие действия:
- Загружает данные поля.
- Выбирает дрон.
- Рассчитывает метрики полета.
- Генерирует сетку полета.
- Удаляет запретные зоны.
- Рассчитывает маршрут полета.
- Экспортирует маршруты в GeoJSON.

Сильные стороны:
- Интеграция всех модулей в единый процесс.
- Простота использования и настройки.

### drones.py

Определяет класс `Drone` и содержит словарь с доступными моделями дронов.

Сильные стороны:
- Гибкость в добавлении новых моделей дронов.
- Легкость доступа к свойствам дронов.

### fields.py

Обрабатывает данные поля, загружает координаты поля, запретных зон и начальной точки, а также рассчитывает площадь поля.

Сильные стороны:
- Преобразование координат в UTM для корректного расчета площади.
- Обработка исключений при загрузке данных.

### geojson_export.py

Экспортирует маршруты полета в файл GeoJSON.

Сильные стороны:
- Проверка на пустой список перед добавлением LineString в geojson.Feature.
- Удобство использования и интеграция с другими модулями.

### operator_commands.py

Обрабатывает команды оператора и выполняет маршруты полета.

Сильные стороны:
- Обработка команд оператора, таких как возврат на базу, экстренная посадка и удержание позиции.
- Расчет маршрутов с учетом заправок и подзарядок.

### routing.py

Содержит функции для генерации сетки полета, удаления запретных зон и расчета маршрута полета.

Сильные стороны:
- Проверка на корректность преобразования координат в целях создания сетки полета.
- Использование STRtree для оптимизации проверки пересечений.
- Проверка на корректность создания полигонов.

## Заключение

Наш код разработан с учетом всех необходимых требований и предоставляет гибкие и надежные инструменты для планирования полета сельскохозяйственного дрона. Мы предусмотрели обработку исключений, проверку корректности данных и оптимизацию алгоритмов для обеспечения высокой производительности и точности расчетов.
